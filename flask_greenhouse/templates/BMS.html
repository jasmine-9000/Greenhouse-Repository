{% extends "layout.html" %}

{% block content %}
	<h1>Request BMS Data</h1>
	<script>
	// logging the BMS URL here. 
	const BMS_URL = "{{ url_for('bms.BMS_data_retrieval', date='<date>', parameter='<parameter>') }}";
	console.log("URL TO MAKE REQUESTS TO \(UNFORMATTED\):" + BMS_URL);
	
	// make default dates to now.
	window.addEventListener("load", function() {
		var now = new Date();
		var utcString = now.toISOString().substring(0,19);
		var year = now.getFullYear();
		var month = now.getMonth() + 1;
		var day = now.getDate();
		var hour = now.getHours();
		var minute = now.getMinutes();
		var second = now.getSeconds();
		var localDatetime = year + "-" +
						  (month < 10 ? "0" + month.toString() : month) + "-" +
						  (day < 10 ? "0" + day.toString() : day) + "T" +
						  (hour < 10 ? "0" + hour.toString() : hour) + ":" +
						  (minute < 10 ? "0" + minute.toString() : minute);
						  //utcString.substring(16,19);
		var datetimeField = document.getElementById("start_date");
		datetimeField.value = localDatetime;
		var datetimeField2 = document.getElementById("end_date");
		datetimeField2.value = localDatetime;
	});
	</script>
{######################################################################################
							BMS Request Form.
							
			This form is controlled by BMS_graph_loader.js, located in the static folder.
			Please modify that JS file to modify the graphing mechanism.
			Pass in the single data point API URL by setting data-BASE_URL to it. 
			Pass in the multi data point API URL by setting data-MULTI_BASE_URL to it. 
			This only works in HTML5.
			
			Currently the API URLs are as follows:
			
			To retrieve a single datapoint, make a request to:
				http://<hostname>/BMS/api/single_data_point/<date>/<parameter>
			This will return a JSON file with this format:
				{
					"x": 1,
					"date": <date>,
					"parameter": <parameter>
				}
			Where x is the data point you seek.
			
			To retrieve multiple datapoints simultaneously, make a request to:
				http://<hostname>/BMS/api/<start_date>/<end_date>/<interval>/<parameter>
			This will return a JSON file with this format:
				"parameter": <parameter>,
				"data": {
					<start_date>: 1,
					<start_date> + <interval>: 2,
					<start_date> + 2*<interval>: 3 ,
						...
					<end_date>: n
				}
			Where the data points appear from start_date to end_date in intervals of <interval>.
##############################################################################################}
	<form action="#" id="BMS_form" data-BASE_URL="{{ url_for('bms.BMS_data_retrieval', date='<date>', parameter='<parameter>') }}", data-MULTI_BASE_URL="{{ url_for('bms.BMS_multi_data_retrieval', start_date='<start_date>', end_date='<end_date>', interval=5555, parameter='<parameter>') }}">
			<div class="row">
				<div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
					{{ form.start_date.label }}
					{{ form.start_date }}
					<small class="form-text text-muted">Start date must be before 10/12/2019</small>
				</div>
				<div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
					{{ form.end_date.label }}
					{{ form.end_date }}
					<small class="form-text text-muted">Start date must be before end date.</small>
				</div>
				<div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
					{{ form.interval.label }}
					{{ form.interval }}
					<small class="form-text text-muted">Interval must be a multiple of 10 minutes.</small>
				</div>
			</div>
			<div class="form-group">
				{{ form.units.label }}
				{{ form.units }}
				
			</div>	
			<div class="form-group">
				<label for="title">Title</label><br />
				<input type="text" name="title" id="title" value="Untitled Graph">
			</div>
			<div class="row">
				<div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
					<label for="xaxistitle">X-axis title</label><br />
					<input type="text" name="xaxistitle" id="xaxistitle">
				</div>
				<div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
					<label for="yaxistitle">Y-axis title</label><br />
					<input type="text" name="yaxistitle" id="yaxistitle">
				</div>
			</div>
			<div class="row">
				<div class="col-lg-6 col-md-6 col-sm-6 col-xs-12 form-group">
					<label for="font_family">Font Family</label><br />
					<select name="font_family" id="style">
						<option value="Courier New">Courier New</option>
						<option value="Serif">Serif</option>
						<option value="Sans Serif">Sans Serif</option>
					</select>
				</div>
				<div class="col-lg-6 col-md-6 col-sm-6 col-xs-12 form-group">
					<label for="marker">Marker</label><br />
					<select name="marker" id="marker">
						<option value="fivethirtyeight">No Marker</option>
						<option value="classic">Star</option>
					</select>
				</div>
			</div>
			<div class="row">
				<div class="col">
					<label for="tightlayout">Tight Layout</label>
					<input type="checkbox" name="tightlayout" id="tightlayout">
				</div>
				<div class="col">
					<label for="logarithmic">Y-axis Logarithmic Scale</label>
					<input type="checkbox" name="logarithmic" id="logarithmic">
				</div>
			</div>
			
			<input type="submit" value="Request Graph">  
		</form>
		
	</form>
	<div id="chart"></div>
	<script src="{{ url_for('static', filename='BMS_graph_loader.js') }}"></script>
	
	<!-- we're keeping a local copy of plotly-latest for faster load speeds.-->
	<script src="{{ url_for('static', filename='plotly-latest.min.js') }}"> </script>
{######################################################################################
							Miscellaneous Links
		These are miscellaneous links that might be helpful.
		These links view the last data point sent to the server. 
		The last Tristar data point is written to an internal server folder as a file AND saved to our database.
		Opening a file in Python is faster than asking for it from the database, and easier to manage.
		
		Because the last data point lists the alarms, faults, and flags currently raised, it should be accessed very often.
					
######################################################################################}
	<p>
		<a href = "{{ url_for('bms.BMS_Instantaneous') }}">See instantaneous values</a><br />
		<a href = "{{ url_for('bms.BMS_pins') }}">See pins currently attached</a>
	</p>
{% endblock %}


