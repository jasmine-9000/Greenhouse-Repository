{% extends "layout.html" %}

{% block content %}
	<h1>Request BMS Data</h1>
	<script>
	// logging the BMS URL here. 
	const BMS_URL = "{{ url_for('bms.BMS_data_retrieval', date='<date>', parameter='<parameter>') }}";
	console.log("URL TO MAKE REQUESTS TO \(UNFORMATTED\):" + BMS_URL);
	
	// make default dates to now.
	window.addEventListener("load", function() {
		var now = new Date();
		var utcString = now.toISOString().substring(0,19);
		var year = now.getFullYear();
		var month = now.getMonth() + 1;
		var day = now.getDate();
		var hour = now.getHours();
		var minute = now.getMinutes();
		var second = now.getSeconds();
		var localDatetime = year + "-" +
						  (month < 10 ? "0" + month.toString() : month) + "-" +
						  (day < 10 ? "0" + day.toString() : day) + "T" +
						  (hour < 10 ? "0" + hour.toString() : hour) + ":" +
						  (minute < 10 ? "0" + minute.toString() : minute);
						  //utcString.substring(16,19);
		var datetimeField = document.getElementById("startdate");
		datetimeField.value = localDatetime;
		var datetimeField2 = document.getElementById("enddate");
		datetimeField2.value = localDatetime;
	});
	</script>
	<form action="#" id="BMS_form" data-BASE_URL="{{ url_for('bms.BMS_data_retrieval', date='<date>', parameter='<parameter>') }}", data-MULTI_BASE_URL="{{ url_for('bms.BMS_multi_data_retrieval', start_date='<start_date>', end_date='<end_date>', interval=5555, parameter='<parameter>') }}">
			<div class="row">
				<div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
					<label for="startdate">Start Date</label>
					<input type="datetime-local" id="startdate" value="Today">
					<small class="form-text text-muted">Start date must be before 10/12/2019</small>
				</div>
				<div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
					<label for="enddate">End Date</label>
					<input type="datetime-local" id="enddate">
					<small class="form-text text-muted">Start date must be before end date.</small>
				</div>
				<div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
					<label for="interval">Interval (minutes)</label>
					<input type="text" id="interval">
					<small class="form-text text-muted">Interval must be a multiple of 10 minutes.</small>
				</div>
			</div>
			<div class="form-group">
				<label for="units">Units</label><br />
				<select name="units" id="units">
					<option value="bat_charge">Battery Charge</option>
					<option value="pv_voltage">PV voltage</option>
					<option value="pv_current">PV current</option>
					<option value="bat_voltage">Battery Voltage</option>
				</select>
			</div>	
			<div class="form-group">
				<label for="title">Title</label><br />
				<input type="text" name="title" id="title" value="Untitled Graph">
			</div>
			<div class="row">
				<div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
					<label for="xaxistitle">X-axis title</label><br />
					<input type="text" name="xaxistitle" id="xaxistitle">
				</div>
				<div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
					<label for="yaxistitle">Y-axis title</label><br />
					<input type="text" name="yaxistitle" id="yaxistitle">
				</div>
			</div>
			<div class="row">
				<div class="col-lg-6 col-md-6 col-sm-6 col-xs-12 form-group">
					<label for="font_family">Font Family</label><br />
					<select name="font_family" id="style">
						<option value="Courier New">Courier New</option>
						<option value="Serif">Serif</option>
						<option value="Sans Serif">Sans Serif</option>
					</select>
				</div>
				<div class="col-lg-6 col-md-6 col-sm-6 col-xs-12 form-group">
					<label for="marker">Marker</label><br />
					<select name="marker" id="marker">
						<option value="fivethirtyeight">No Marker</option>
						<option value="classic">Star</option>
					</select>
				</div>
			</div>
			<div class="row">
				<div class="col">
					<label for="tightlayout">Tight Layout</label>
					<input type="checkbox" name="tightlayout" id="tightlayout">
				</div>
				<div class="col">
					<label for="logarithmic">Y-axis Logarithmic Scale</label>
					<input type="checkbox" name="logarithmic" id="logarithmic">
				</div>
			</div>
			
			<input type="submit" value="Request Graph">  
		</form>
		
	</form>
	<div id="chart"></div>
	<script src="{{ url_for('static', filename='BMS_graph_loader.js') }}"></script>
	
	<!-- we're keeping a local copy of plotly-latest for faster load speeds.-->
	<script src="{{ url_for('static', filename='plotly-latest.min.js') }}"> </script>
	<p>
		<a href = "{{ url_for('bms.BMS_Instantaneous') }}">See instantaneous values</a><br />
		<a href = "{{ url_for('bms.BMS_pins') }}">See pins currently attached</a>
	</p>
{% endblock %}


