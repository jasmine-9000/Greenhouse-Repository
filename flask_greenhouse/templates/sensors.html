{% extends "layout.html" %}
{% block content %}
	<h1> Sensor Data Request Form </h1>
	<script>
	// make default dates to now.
	window.addEventListener("load", function() {
		var now = new Date();
		var utcString = now.toISOString().substring(0,19);
		var year = now.getFullYear();
		var month = now.getMonth() + 1;
		var day = now.getDate();
		var hour = now.getHours();
		var minute = now.getMinutes();
		var second = now.getSeconds();
		var localDatetime = year + "-" +
						  (month < 10 ? "0" + month.toString() : month) + "-" +
						  (day < 10 ? "0" + day.toString() : day) + "T" +
						  (hour < 10 ? "0" + hour.toString() : hour) + ":" +
						  (minute < 10 ? "0" + minute.toString() : minute);
		//console.log(localDatetime);
		//console.log(utcString.substring(16,19));
		var datetimeField = document.getElementById("{{ form.start_date.id }}");
		datetimeField.value = localDatetime;
		var datetimeField2 = document.getElementById("{{ form.end_date.id }}");
		datetimeField2.value = localDatetime;
	});
	</script>
	<form method="POST" id="sensor_form" data-BASE_URL="{{ url_for('sensor_nodes.sensor_id_JSON', sensor_id=-1, date='<date>') }}", onsubmit="return false">
		{{ form.csrf_token }}
		<legend class="border-bottom mb-4">Request Sensor data (graph)</legend>
			<div class="form-group">
			{{ form.sensors_owned.label }}
			{{ form.sensors_owned }}
			</div>
			<div class="form-group">
			{{ form.start_date.label }}
			{{ form.start_date }}
			</div>
			<div class="form-group">
			{{ form.end_date.label }}
			{{ form.end_date }}
			<small class="form-text text-muted">Start Date must be before end date.</small>
			</div>
			<div class="form-group">
			{{ form.interval.label }}
			{{ form.interval }}
			<small class="form-text text-muted">Interval must be a multiple of 10 minutes.</small>
			</div>
			<div class="form-group">
			{{ form.x_axis.label }}
			{{ form.x_axis }}
			</div>
			<div class="form-group">
			{{ form.y_axis.label }}
			{{ form.y_axis }}
			</div>
			<div class="form-group">
			{{ form.title.label }}
			{{ form.title }}
			</div>
			{{ form.submit }}
	</form>
	<div id="chart">
	</div>
	<!-- we're keeping a local copy of plotly-latest for faster load speeds.-->
	<script src="{{ url_for('static', filename='plotly-latest.min.js') }}"> </script>
	Don't see your sensor listed? <a href="{{ url_for('sensor_nodes.register_sensor') }}">Register a sensor.</a>
	<br >
	Don't see anything at all? Please report this page to the webmaster.
	<a href="{{ url_for('sensor_nodes.user_login') }}">Here's the login form just in case.</a>

	<script src="{{ url_for('static', filename='sensor_graph_loader.js') }} "> </script>
	<div id='chart'>
	
	</div>
{% endblock %}